<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Global Helper & User Log Guide</title>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            line-height: 1.6;
            background: #f9fafb;
            color: #111827;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: auto;
            background: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        h1, h2, h3 {
            color: #1f2937;
        }
        h1 {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        pre {
            background: #111827;
            color: #e5e7eb;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
        }
        code {
            color: #e5e7eb;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        table th, table td {
            border: 1px solid #e5e7eb;
            padding: 10px;
            text-align: left;
        }
        table th {
            background: #f3f4f6;
        }
        .note {
            background: #eff6ff;
            border-left: 4px solid #3b82f6;
            padding: 10px;
            margin: 15px 0;
        }
    </style>
</head>
<body>

<div class="container">
<a href="role_and_permission.html">Role And Permission</a>
<a href="starting_project_with_laravel.html">Starting laravel new project</a>
<a href="userlogs.html">User Logs Action</a>
<h1>Laravel Global Helper & User Log (Audit Log) Guide</h1>

<p>This document explains how to create a <strong>global helper in Laravel</strong> and use it anywhere in your project to record <strong>user activity logs (audit logs)</strong>.</p>

<hr>

<h2>1. What Is a Global Helper?</h2>
<p>A <strong>global helper</strong> is a PHP function that can be called anywhere in Laravel without importing a class.</p>
<ul>
    <li>Controllers</li>
    <li>Models</li>
    <li>Middleware</li>
    <li>Blade views</li>
    <li>API routes</li>
</ul>

<hr>

<h2>2. Create User Logs Table</h2>

<h3>Migration</h3>
<pre><code>php artisan make:migration create_user_logs_table</code></pre>

<pre><code>Schema::create('user_logs', function (Blueprint $table) {
    $table->id();
    $table->unsignedBigInteger('user_id')->nullable();
    $table->string('action');
    $table->string('module')->nullable();
    $table->text('description')->nullable();
    $table->ipAddress('ip_address')->nullable();
    $table->string('user_agent')->nullable();
    $table->timestamps();
});</code></pre>

<pre><code>php artisan migrate</code></pre>

<hr>

<h2>3. Create UserLog Model</h2>
<pre><code>php artisan make:model UserLog</code></pre>

<pre><code>class UserLog extends Model
{
    protected $fillable = [
        'user_id',
        'action',
        'module',
        'description',
        'ip_address',
        'user_agent',
    ];
}</code></pre>

<hr>

<h2>4. Create Global Helper File</h2>

<h3>File Location</h3>
<pre><code>app/Helpers/helpers.php</code></pre>

<h3>Helper Code</h3>
<pre><code>&lt;?php

use App\Models\UserLog;

if (!function_exists('userLog')) {
function userLog($action, $module = null, $description = null)
{
UserLog::create([
'user_id'     => auth()->id(),
'action'      => $action,
'module'      => $module,
'description' => $description,
'ip_address'  => request()->ip(),
'user_agent'  => request()->userAgent(),
]);
}
}</code></pre>

<hr>

<h2>5. Register Helper Globally</h2>

<pre><code>"autoload": {
  "psr-4": {
    "App\\": "app/"
  },
  "files": [
    "app/Helpers/helpers.php"
  ]
}</code></pre>

<pre><code>composer dump-autoload</code></pre>

<div class="note">
<strong>Important:</strong> This step is required or the helper will not work.
</div>

<hr>

<h2>6. Using the Helper Anywhere</h2>

<pre><code>userLog('create', 'customer', 'Created new customer');</code></pre>

<pre><code>userLog('update', 'order', 'Order updated');</code></pre>

<pre><code>userLog('access', 'page', request()->path());</code></pre>

<hr>

<h2>7. Optional: Auto Log Page Access (Middleware)</h2>

<pre><code>php artisan make:middleware LogUserActivity</code></pre>

<pre><code>public function handle($request, Closure $next)
{
    if (auth()->check()) {
        userLog('access', 'page', $request->path());
    }

    return $next($request);
}</code></pre>

<hr>

<h2>8. Best Practices</h2>
<ul>
    <li>Never log passwords or sensitive data</li>
    <li>Show logs only to admins</li>
    <li>Clean old logs with a scheduled job</li>
    <li>Keep helpers small and reusable</li>
    <li>Use services for complex logic</li>
</ul>

<hr>

<h2>9. Common Mistakes</h2>
<table>
    <tr>
        <th>Issue</th>
        <th>Solution</th>
    </tr>
    <tr>
        <td>Helper not working</td>
        <td>Run composer dump-autoload</td>
    </tr>
    <tr>
        <td>Function redeclared</td>
        <td>Use function_exists()</td>
    </tr>
    <tr>
        <td>Namespace in helper</td>
        <td>Do not use namespaces</td>
    </tr>
</table>

<hr>

<h2>10. Result</h2>
<p>You now have a global helper available everywhere with a clean and secure user activity logging system.</p>

<p><strong>End of Document</strong></p>

</div>

</body>
</html>
